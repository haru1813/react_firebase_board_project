<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비지니스 로직 정의서 - React Firebase 게시판 프로젝트</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 4px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        h3 {
            color: #555;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        h4 {
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .business-logic {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .flow-diagram {
            background: #e8f4f8;
            border: 2px solid #3498db;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .flow-step {
            display: inline-block;
            background: white;
            border: 2px solid #3498db;
            border-radius: 5px;
            padding: 15px 25px;
            margin: 10px;
            min-width: 150px;
        }
        .flow-arrow {
            display: inline-block;
            font-size: 24px;
            color: #3498db;
            margin: 0 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:hover { background: #f5f5f5; }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
        }
        li {
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>비지니스 로직 정의서</h1>
        <p><strong>프로젝트명:</strong> React Firebase 게시판 프로젝트</p>
        <p><strong>작성일:</strong> 2024년</p>
        <p><strong>버전:</strong> 1.0</p>

        <h2>1. 인증 관련 비지니스 로직</h2>

        <div class="business-logic">
            <h3>1.1 회원가입 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">사용자 입력<br/>(이메일, 비밀번호, 이름)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">유효성 검증</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firebase Auth<br/>계정 생성</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firestore<br/>사용자 정보 저장</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">성공 처리</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>입력 데이터 검증</strong>
                    <ul>
                        <li>이메일 형식 검증 (정규식 사용)</li>
                        <li>비밀번호 길이 검증 (최소 6자 이상)</li>
                        <li>비밀번호 재확인 일치 여부 확인</li>
                        <li>이름 필수 입력 확인</li>
                    </ul>
                </li>
                <li><strong>중복 이메일 확인</strong>
                    <ul>
                        <li>Firebase Auth에서 이메일 중복 체크</li>
                        <li>중복 시 에러 메시지 반환</li>
                    </ul>
                </li>
                <li><strong>Firebase Authentication 계정 생성</strong>
                    <ul>
                        <li>createUserWithEmailAndPassword() 호출</li>
                        <li>성공 시 User 객체 반환</li>
                    </ul>
                </li>
                <li><strong>Firestore에 사용자 정보 저장</strong>
                    <ul>
                        <li>users 컬렉션에 문서 생성 (문서 ID = UID)</li>
                        <li>저장 필드: email, displayName, createdAt, updatedAt</li>
                    </ul>
                </li>
                <li><strong>에러 처리</strong>
                    <ul>
                        <li>네트워크 에러 처리</li>
                        <li>Firebase 에러 코드에 따른 사용자 친화적 메시지 표시</li>
                    </ul>
                </li>
            </ol>

            <h4>에러 케이스</h4>
            <table>
                <tr>
                    <th>에러 코드</th>
                    <th>상황</th>
                    <th>처리 방법</th>
                </tr>
                <tr>
                    <td>auth/email-already-in-use</td>
                    <td>이미 사용 중인 이메일</td>
                    <td>"이미 사용 중인 이메일입니다." 메시지 표시</td>
                </tr>
                <tr>
                    <td>auth/invalid-email</td>
                    <td>잘못된 이메일 형식</td>
                    <td>"올바른 이메일 형식을 입력해주세요." 메시지 표시</td>
                </tr>
                <tr>
                    <td>auth/weak-password</td>
                    <td>비밀번호가 너무 약함</td>
                    <td>"비밀번호는 6자 이상이어야 합니다." 메시지 표시</td>
                </tr>
            </table>
        </div>

        <div class="business-logic">
            <h3>1.2 로그인 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">사용자 입력<br/>(이메일, 비밀번호)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">입력 검증</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firebase Auth<br/>로그인 시도</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">인증 토큰 발급</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">사용자 정보 로드</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">세션 유지</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>입력 데이터 검증</strong>
                    <ul>
                        <li>이메일, 비밀번호 필수 입력 확인</li>
                        <li>이메일 형식 검증</li>
                    </ul>
                </li>
                <li><strong>Firebase Authentication 로그인</strong>
                    <ul>
                        <li>signInWithEmailAndPassword() 호출</li>
                        <li>인증 성공 시 UserCredential 반환</li>
                    </ul>
                </li>
                <li><strong>사용자 정보 조회</strong>
                    <ul>
                        <li>Firestore에서 users 컬렉션 조회</li>
                        <li>사용자 프로필 정보 로드</li>
                    </ul>
                </li>
                <li><strong>세션 관리</strong>
                    <ul>
                        <li>Firebase Auth가 자동으로 세션 유지</li>
                        <li>onAuthStateChanged()로 인증 상태 모니터링</li>
                    </ul>
                </li>
            </ol>

            <h4>에러 케이스</h4>
            <table>
                <tr>
                    <th>에러 코드</th>
                    <th>상황</th>
                    <th>처리 방법</th>
                </tr>
                <tr>
                    <td>auth/user-not-found</td>
                    <td>존재하지 않는 사용자</td>
                    <td>"등록되지 않은 이메일입니다." 메시지 표시</td>
                </tr>
                <tr>
                    <td>auth/wrong-password</td>
                    <td>잘못된 비밀번호</td>
                    <td>"비밀번호가 일치하지 않습니다." 메시지 표시</td>
                </tr>
                <tr>
                    <td>auth/invalid-email</td>
                    <td>잘못된 이메일 형식</td>
                    <td>"올바른 이메일 형식을 입력해주세요." 메시지 표시</td>
                </tr>
            </table>
        </div>

        <div class="business-logic">
            <h3>1.3 로그아웃 로직</h3>
            <h4>상세 로직</h4>
            <ol>
                <li>signOut() 함수 호출</li>
                <li>Firebase Auth 세션 종료</li>
                <li>로컬 상태 초기화</li>
                <li>로그인 페이지로 리다이렉트</li>
            </ol>
        </div>

        <h2>2. 게시판 관련 비지니스 로직</h2>

        <div class="business-logic">
            <h3>2.1 게시글 작성 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">인증 확인</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">입력 데이터 검증</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firestore에<br/>게시글 저장</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">게시글 목록<br/>새로고침</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>인증 상태 확인</strong>
                    <ul>
                        <li>현재 사용자가 로그인되어 있는지 확인</li>
                        <li>미인증 시 로그인 페이지로 리다이렉트</li>
                    </ul>
                </li>
                <li><strong>입력 데이터 검증</strong>
                    <ul>
                        <li>제목: 필수 입력, 최대 200자</li>
                        <li>내용: 필수 입력</li>
                        <li>XSS 공격 방지를 위한 입력값 검증</li>
                    </ul>
                </li>
                <li><strong>게시글 데이터 구성</strong>
                    <ul>
                        <li>title: 제목</li>
                        <li>content: 내용</li>
                        <li>authorId: 현재 사용자 UID</li>
                        <li>createdAt: 현재 시간 (서버 타임스탬프)</li>
                        <li>updatedAt: 현재 시간</li>
                        <li>viewCount: 0 (초기값)</li>
                    </ul>
                </li>
                <li><strong>Firestore에 저장</strong>
                    <ul>
                        <li>posts 컬렉션에 문서 추가</li>
                        <li>addDoc() 또는 setDoc() 사용</li>
                    </ul>
                </li>
                <li><strong>성공 처리</strong>
                    <ul>
                        <li>성공 메시지 표시</li>
                        <li>게시글 목록 페이지로 이동</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>2.2 게시글 목록 조회 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">인증 확인</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firestore<br/>쿼리 실행</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">데이터 정렬<br/>(최신순)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">페이지네이션<br/>처리</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">화면에 표시</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>인증 상태 확인</strong>
                    <ul>
                        <li>로그인된 사용자만 게시글 조회 가능</li>
                    </ul>
                </li>
                <li><strong>Firestore 쿼리 구성</strong>
                    <ul>
                        <li>collection('posts') 참조</li>
                        <li>orderBy('createdAt', 'desc') - 최신순 정렬</li>
                        <li>limit() - 페이지당 게시글 수 제한</li>
                    </ul>
                </li>
                <li><strong>실시간 업데이트</strong>
                    <ul>
                        <li>onSnapshot() 사용하여 실시간 데이터 동기화</li>
                        <li>새 게시글 작성 시 자동으로 목록 업데이트</li>
                    </ul>
                </li>
                <li><strong>작성자 정보 조인</strong>
                    <ul>
                        <li>각 게시글의 authorId로 users 컬렉션 조회</li>
                        <li>작성자 이름(displayName) 표시</li>
                    </ul>
                </li>
                <li><strong>페이지네이션</strong>
                    <ul>
                        <li>startAfter()를 사용한 커서 기반 페이지네이션</li>
                        <li>무한 스크롤 또는 페이지 번호 방식 선택 가능</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>2.3 게시글 상세 조회 로직</h3>
            <h4>상세 로직</h4>
            <ol>
                <li><strong>게시글 ID로 조회</strong>
                    <ul>
                        <li>doc('posts', postId)로 특정 게시글 조회</li>
                        <li>getDoc() 또는 onSnapshot() 사용</li>
                    </ul>
                </li>
                <li><strong>조회수 증가</strong>
                    <ul>
                        <li>updateDoc()로 viewCount 필드 증가</li>
                        <li>increment(1) 사용</li>
                    </ul>
                </li>
                <li><strong>작성자 정보 조회</strong>
                    <ul>
                        <li>authorId로 users 컬렉션에서 작성자 정보 조회</li>
                    </ul>
                </li>
                <li><strong>권한 확인</strong>
                    <ul>
                        <li>현재 사용자가 작성자인지 확인</li>
                        <li>작성자일 경우 수정/삭제 버튼 표시</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>2.4 게시글 수정 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">권한 확인<br/>(작성자 여부)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">입력 데이터 검증</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">Firestore<br/>업데이트</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">상세 페이지<br/>새로고침</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>권한 확인</strong>
                    <ul>
                        <li>현재 사용자 UID와 게시글 authorId 비교</li>
                        <li>일치하지 않으면 수정 불가 에러 반환</li>
                    </ul>
                </li>
                <li><strong>입력 데이터 검증</strong>
                    <ul>
                        <li>제목, 내용 필수 입력 확인</li>
                    </ul>
                </li>
                <li><strong>업데이트 데이터 구성</strong>
                    <ul>
                        <li>title: 수정된 제목</li>
                        <li>content: 수정된 내용</li>
                        <li>updatedAt: 현재 시간 (서버 타임스탬프)</li>
                    </ul>
                </li>
                <li><strong>Firestore 업데이트</strong>
                    <ul>
                        <li>updateDoc()로 게시글 업데이트</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>2.5 게시글 삭제 로직</h3>
            <h4>프로세스 흐름</h4>
            <div class="flow-diagram">
                <div class="flow-step">권한 확인<br/>(작성자 여부)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">삭제 확인<br/>(사용자 확인)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">연관 댓글 삭제</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">게시글 삭제</div>
                <span class="flow-arrow">→</span>
                <div class="flow-step">목록 페이지로 이동</div>
            </div>

            <h4>상세 로직</h4>
            <ol>
                <li><strong>권한 확인</strong>
                    <ul>
                        <li>현재 사용자 UID와 게시글 authorId 비교</li>
                        <li>일치하지 않으면 삭제 불가 에러 반환</li>
                    </ul>
                </li>
                <li><strong>삭제 확인</strong>
                    <ul>
                        <li>사용자에게 삭제 확인 다이얼로그 표시</li>
                        <li>확인 시에만 삭제 진행</li>
                    </ul>
                </li>
                <li><strong>연관 데이터 삭제</strong>
                    <ul>
                        <li>해당 게시글의 모든 댓글 삭제 (comments 컬렉션)</li>
                        <li>where('postId', '==', postId)로 댓글 조회 후 삭제</li>
                    </ul>
                </li>
                <li><strong>게시글 삭제</strong>
                    <ul>
                        <li>deleteDoc()로 게시글 삭제</li>
                    </ul>
                </li>
                <li><strong>성공 처리</strong>
                    <ul>
                        <li>성공 메시지 표시</li>
                        <li>게시글 목록 페이지로 이동</li>
                    </ul>
                </li>
            </ol>
        </div>

        <h2>3. 공통 비지니스 로직</h2>

        <div class="business-logic">
            <h3>3.1 인증 상태 관리</h3>
            <h4>상세 로직</h4>
            <ol>
                <li><strong>인증 상태 모니터링</strong>
                    <ul>
                        <li>onAuthStateChanged()로 인증 상태 변화 감지</li>
                        <li>로그인/로그아웃 시 자동으로 상태 업데이트</li>
                    </ul>
                </li>
                <li><strong>보호된 라우트</strong>
                    <ul>
                        <li>인증이 필요한 페이지 접근 시 체크</li>
                        <li>미인증 시 로그인 페이지로 리다이렉트</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>3.2 에러 처리</h3>
            <h4>에러 처리 전략</h4>
            <ol>
                <li><strong>Firebase 에러 처리</strong>
                    <ul>
                        <li>Firebase 에러 코드를 사용자 친화적 메시지로 변환</li>
                        <li>에러 로깅 (콘솔 또는 에러 추적 서비스)</li>
                    </ul>
                </li>
                <li><strong>네트워크 에러 처리</strong>
                    <ul>
                        <li>네트워크 연결 실패 시 재시도 로직</li>
                        <li>오프라인 상태 감지 및 처리</li>
                    </ul>
                </li>
                <li><strong>유효성 검증 에러</strong>
                    <ul>
                        <li>입력값 검증 실패 시 즉시 피드백 제공</li>
                        <li>에러 메시지를 입력 필드 근처에 표시</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div class="business-logic">
            <h3>3.3 데이터 캐싱 및 최적화</h3>
            <h4>최적화 전략</h4>
            <ol>
                <li><strong>Firestore 쿼리 최적화</strong>
                    <ul>
                        <li>필요한 필드만 조회 (필드 선택)</li>
                        <li>인덱스 설정으로 쿼리 성능 향상</li>
                        <li>페이지네이션으로 데이터 양 제한</li>
                    </ul>
                </li>
                <li><strong>로컬 상태 관리</strong>
                    <ul>
                        <li>React Context 또는 상태 관리 라이브러리 사용</li>
                        <li>불필요한 리렌더링 방지</li>
                    </ul>
                </li>
            </ol>
        </div>

        <h2>4. 보안 관련 비지니스 로직</h2>

        <div class="business-logic">
            <h3>4.1 Firestore 보안 규칙</h3>
            <h4>규칙 요약</h4>
            <ul>
                <li>모든 읽기/쓰기 작업은 인증된 사용자만 가능</li>
                <li>사용자는 자신의 정보만 수정 가능</li>
                <li>게시글은 작성자만 수정/삭제 가능</li>
                <li>댓글은 작성자만 수정/삭제 가능</li>
            </ul>
        </div>

        <div class="business-logic">
            <h3>4.2 입력값 검증 및 XSS 방지</h3>
            <h4>검증 항목</h4>
            <ul>
                <li>HTML 태그 제거 또는 이스케이프 처리</li>
                <li>스크립트 태그 필터링</li>
                <li>입력값 길이 제한</li>
                <li>특수 문자 검증</li>
            </ul>
        </div>
    </div>
</body>
</html>

